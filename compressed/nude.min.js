(function(){ var nude = (function(){ var canvas = null, ctx = null, resultFn = null, initCanvas = function(){ canvas = document.createElement("canvas"); canvas.style.display = "none"; var b = document.getElementsByTagName("body")[0]; b.appendChild(canvas); ctx = canvas.getContext("2d"); }, loadImageById = function(id){ var img = document.getElementById(id); canvas.width = img.width; canvas.height = img.height; resultFn = null; ctx.drawImage(img, 0, 0); }, loadImageByElement = function(element){ canvas.width = element.width; canvas.height = element.height; resultFn = null; ctx.drawImage(element, 0, 0); }, scanImage = function(){ var image = ctx.getImageData(0, 0, canvas.width, canvas.height), imageData = image.data; var myWorker = new Worker('worker.nude.js'), message = [imageData, canvas.width, canvas.height]; myWorker.postMessage(message); myWorker.onmessage = function(event){ resultHandler(event.data); } }, scanVideo = function(imageData, width, height, callback) { myWorker = new Worker('worker.nude.js'); myWorker.postMessage([imageData, width, height]); myWorker.onmessage = function(event) { callback(event.data); terminateWorker(); }; }; terminateWorker = function() { myWorker.terminate(); }, resultHandler = function(result){ if(resultFn){ resultFn(result); }else{ if(result) console.log("the picture contains nudity")}};return{ init: function(){ initCanvas(); if(!!!window.Worker){ document.write(decodeURIComponent("%3Cscript src='noworker.nude.js' type='text/javascript'%3E%3C/script%3E")); } }, load: function(param){ if(typeof(param) == "string"){ loadImageById(param); }else{ loadImageByElement(param); } }, scan: function(fn){ if(arguments.length>0 && typeof(arguments[0]) == "function"){ resultFn = fn; } scanImage(); }, scanVideo: scanVideo }; })(); if(!window.nude) window.nude = nude; nude.init(); })();
